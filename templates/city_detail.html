<!DOCTYPE html>
<html lang="zh-CN">
<meta name="keywords" content="{{ city_name }}, {{ city_name }}æ—…æ¸¸, {{ city_name }}ç¾é£Ÿ, çº¢è‰²æ—…æ¸¸, å¿—æ„¿æœåŠ¡, ç‚¹äº®ä¸­å›½">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ city_name }} - ç‚¹äº®ä¸­å›½æ—…æ¸¸å¹³å°</title>
    <meta name="description" content="{{ city_name }}æ—…æ¸¸æ”»ç•¥ï¼Œçº¢è‰²å†å²è·¯çº¿ï¼Œç½‘çº¢ç¾é£Ÿæ‰“å¡ï¼Œå¿—æ„¿æœåŠ¡ä¿¡æ¯">
    
    <!-- æ ·å¼æ–‡ä»¶ -->    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/city.css') }}">
    
    <!-- åœ°å›¾åº“å°†åœ¨é¡µé¢åº•éƒ¨åŠ è½½ -->
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('main.index') }}" class="logo">ğŸŒŸ ç‚¹äº®ä¸­å›½</a>
            
            <div class="breadcrumb">
                <a href="{{ url_for('main.index') }}">é¦–é¡µ</a>
                <span class="separator">></span>
                <span class="current">{{ city_name }}</span>
            </div>
            
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="æœç´¢{{ city_name }}æ™¯ç‚¹..." id="searchInput">
                <button class="search-btn" id="searchBtn">ğŸ”</button>
            </div>
            
            <nav class="user-menu">
                <a href="#" id="loginBtn">ç™»å½•</a>
                <a href="#" id="registerBtn">æ³¨å†Œ</a>
                <a href="#" id="favoriteBtn" class="favorite-btn">â¤ï¸ æ”¶è—åŸå¸‚</a>
            </nav>
        </div>
    </header>

    <!-- åŸå¸‚æ¦‚è§ˆåŒºåŸŸ -->
    <section class="city-hero">
        <div class="city-hero-bg" data-bg-image="{{ city_data.hero_image or '/static/images/default-city.jpg' }}"></div>
        <div class="city-hero-overlay">
            <div class="city-hero-content">
                <h1 class="city-title">{{ city_name }}</h1>
                <p class="city-subtitle">{{ city_data.description or 'æ¢ç´¢è¿™åº§åŸå¸‚çš„ç‹¬ç‰¹é­…åŠ›' }}</p>
                <div class="city-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ city_data.attractions_count or 0 }}</div>
                        <div class="stat-label">æ™¯ç‚¹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ city_data.routes_count or 0 }}</div>
                        <div class="stat-label">è·¯çº¿</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ city_data.volunteers_count or 0 }}</div>
                        <div class="stat-label">å¿—æ„¿è€…</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ city_data.checkins_count or 0 }}</div>
                        <div class="stat-label">æ‰“å¡</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="city-main">
        <!-- å·¦ä¾§åœ°å›¾åŒºåŸŸ -->
        <div class="city-map-section">
            <div class="map-header">
                <h2>ğŸ—ºï¸ {{ city_name }}æ™¯ç‚¹åˆ†å¸ƒ</h2>
                <div class="map-controls">
                    <button class="control-btn" id="mapTypeBtn">ğŸ”„ åˆ‡æ¢è§†å›¾</button>
                    <button class="control-btn" id="locateBtn">ğŸ“ å®šä½</button>
                    <button class="control-btn" id="routeBtn">ğŸš— è§„åˆ’è·¯çº¿</button>
                </div>
            </div>
            <div id="cityMap" class="city-map"></div>
            
            <!-- åœ°å›¾å›¾ä¾‹ -->
            <div class="map-legend">
                <div class="legend-item">
                    <span class="legend-icon red">ğŸ›ï¸</span>
                    <span class="legend-text">çº¢è‰²å†å²</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon orange">ğŸœ</span>
                    <span class="legend-text">ç½‘çº¢ç¾é£Ÿ</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon blue">ğŸ¤</span>
                    <span class="legend-text">å¿—æ„¿æœåŠ¡</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon green">ğŸï¸</span>
                    <span class="legend-text">è‡ªç„¶æ™¯è§‚</span>
                </div>
            </div>
        </div>

        <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
        <div class="city-content-section">
            <!-- åˆ†ç±»å¯¼èˆª -->
            <div class="category-tabs">
                <button class="tab-btn active" data-category="all">ğŸŒŸ å…¨éƒ¨</button>
                <button class="tab-btn" data-category="history">ğŸ›ï¸ çº¢è‰²å†å²</button>
                <button class="tab-btn" data-category="food">ğŸœ ç½‘çº¢ç¾é£Ÿ</button>
                <button class="tab-btn" data-category="volunteer">ğŸ¤ å¿—æ„¿æœåŠ¡</button>
                <button class="tab-btn" data-category="nature">ğŸï¸ è‡ªç„¶æ™¯è§‚</button>
            </div>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content-area">
                <!-- æ¨èè·¯çº¿å¡ç‰‡ -->
                <div class="section-card routes-section">
                    <div class="section-header">
                        <h3>ğŸ—ºï¸ æ¨èè·¯çº¿</h3>
                        <a href="#" class="more-link">æŸ¥çœ‹å…¨éƒ¨ ></a>
                    </div>
                    <div class="routes-grid">
                        {% for route in recommended_routes %}
                        <div class="route-card" data-route-id="{{ route.id }}">
                            <div class="route-image">
                                <img src="{{ route.image or '/static/images/default-route.jpg' }}" alt="{{ route.name }}" width="300" height="200">
                                <div class="route-duration">{{ route.duration }}å°æ—¶</div>
                            </div>
                            <div class="route-content">
                                <h4 class="route-title">{{ route.name }}</h4>
                                <p class="route-description">{{ route.description[:50] }}...</p>
                                <div class="route-meta">
                                    <span class="route-difficulty">{{ route.difficulty }}</span>
                                    <span class="route-rating">â­ {{ route.rating }}</span>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- æ™¯ç‚¹åˆ—è¡¨ -->
                <div class="section-card attractions-section">
                    <div class="section-header">
                        <h3>ğŸ¯ çƒ­é—¨æ™¯ç‚¹</h3>
                        <div class="filter-controls">
                            <select id="sortSelect">
                                <option value="popularity">æŒ‰çƒ­åº¦æ’åº</option>
                                <option value="rating">æŒ‰è¯„åˆ†æ’åº</option>
                                <option value="distance">æŒ‰è·ç¦»æ’åº</option>
                            </select>
                        </div>
                    </div>
                    <div class="attractions-list" id="attractionsList">
                        {% for attraction in attractions %}
                        <div class="attraction-card" data-category="{{ attraction.category }}" data-attraction-id="{{ attraction.id }}">
                            <div class="attraction-image">
                                <img src="{{ attraction.image or '/static/images/default-attraction.jpg' }}" alt="{{ attraction.name }}" width="300" height="200">
                                <div class="attraction-category">{{ attraction.category_name }}</div>
                                {% if attraction.accessibility %}
                                <div class="accessibility-badge">â™¿ æ— éšœç¢</div>
                                {% endif %}
                            </div>
                            <div class="attraction-content">
                                <h4 class="attraction-title">{{ attraction.name }}</h4>
                                <p class="attraction-description">{{ attraction.description[:80] }}...</p>
                                <div class="attraction-meta">
                                    <div class="rating">
                                        <span class="stars">â­ {{ attraction.rating }}</span>
                                        <span class="reviews">({{ attraction.reviews_count }}æ¡è¯„ä»·)</span>
                                    </div>
                                    <div class="location">ğŸ“ {{ attraction.district }}</div>
                                </div>
                                <div class="attraction-actions">
                                    <button class="btn btn-primary btn-sm" onclick="viewAttraction({{ attraction.id }})">æŸ¥çœ‹è¯¦æƒ…</button>
                                    <button class="btn btn-outline btn-sm" onclick="addToRoute({{ attraction.id }})">åŠ å…¥è·¯çº¿</button>
                                    <button class="btn btn-icon" onclick="toggleFavorite({{ attraction.id }})">â¤ï¸</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- æ™ºèƒ½æ¨è -->
                <div class="section-card recommendations-section">
                    <div class="section-header">
                        <h3>ğŸ¤– æ™ºèƒ½æ¨è</h3>
                        <p class="section-subtitle">åŸºäºæ‚¨çš„å…´è¶£å’Œè¡Œä¸ºæ¨è</p>
                    </div>
                    <div class="recommendations-grid">
                        {% for rec in smart_recommendations %}
                        <div class="recommendation-card">
                            <div class="rec-icon">{{ rec.icon }}</div>
                            <div class="rec-content">
                                <h4>{{ rec.title }}</h4>
                                <p>{{ rec.description }}</p>
                                <a href="{{ rec.link }}" class="rec-link">äº†è§£æ›´å¤š ></a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <div class="bottom-toolbar">
        <button class="toolbar-btn" id="planRouteBtn">
            <span class="btn-icon">ğŸ—ºï¸</span>
            <span class="btn-text">è§„åˆ’è¡Œç¨‹</span>
        </button>
        <button class="toolbar-btn" id="findVolunteerBtn">
            <span class="btn-icon">ğŸ¤</span>
            <span class="btn-text">æ‰¾å¿—æ„¿è€…</span>
        </button>
        <button class="toolbar-btn" id="shareBtn">
            <span class="btn-icon">ğŸ“¤</span>
            <span class="btn-text">åˆ†äº«</span>
        </button>
        <button class="toolbar-btn" id="feedbackBtn">
            <span class="btn-icon">ğŸ’¬</span>
            <span class="btn-text">åé¦ˆ</span>
        </button>
    </div>

    <!-- è¡Œç¨‹è§„åˆ’æ¨¡æ€æ¡† -->
    <div id="routePlanModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ğŸ—ºï¸ æ™ºèƒ½è¡Œç¨‹è§„åˆ’</h3>
                <button class="close-btn" id="closeRoutePlan">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="plan-form">
                    <div class="form-group">
                        <label>å‡ºè¡Œæ—¶é—´ï¼š</label>
                        <input type="date" id="travelDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>æ¸¸ç©å¤©æ•°ï¼š</label>
                        <select id="travelDays" class="form-input">
                            <option value="1">1å¤©</option>
                            <option value="2">2å¤©</option>
                            <option value="3">3å¤©</option>
                            <option value="7">ä¸€å‘¨</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å…´è¶£åå¥½ï¼š</label>
                        <div class="interest-tags">
                            <label class="tag-label"><input type="checkbox" value="history"> å†å²æ–‡åŒ–</label>
                            <label class="tag-label"><input type="checkbox" value="food"> ç¾é£Ÿä½“éªŒ</label>
                            <label class="tag-label"><input type="checkbox" value="nature"> è‡ªç„¶é£å…‰</label>
                            <label class="tag-label"><input type="checkbox" value="shopping"> è´­ç‰©å¨±ä¹</label>
                            <label class="tag-label"><input type="checkbox" value="accessibility"> æ— éšœç¢ä¼˜å…ˆ</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>å‡ºè¡Œæ–¹å¼ï¼š</label>
                        <select id="transportMode" class="form-input">
                            <option value="walking">æ­¥è¡Œä¸ºä¸»</option>
                            <option value="public">å…¬å…±äº¤é€š</option>
                            <option value="taxi">æ‰“è½¦/è‡ªé©¾</option>
                            <option value="mixed">æ··åˆå‡ºè¡Œ</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="generateRouteBtn">ğŸš€ ç”Ÿæˆè¡Œç¨‹</button>
                </div>
                <div class="plan-result hidden" id="planResult">
                    <!-- ç”Ÿæˆçš„è¡Œç¨‹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/city.js') }}"></script>
    <script src="{{ url_for('static', filename='js/google-map.js') }}"></script>
    <script src="{{ url_for('static', filename='js/city-bg.js') }}"></script>
    <script>
        // åŸå¸‚æ•°æ®
        const cityData = {{ city_data | tojson }};
        const attractions = {{ attractions | tojson }};
        const routes = {{ recommended_routes | tojson }};
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–åˆ†ç±»ç­›é€‰
            initCategoryFilter();
            
            // åˆå§‹åŒ–è¡Œç¨‹è§„åˆ’
            initRoutePlanning();
            
            // åŠ è½½åŸå¸‚æ•°æ®
            loadCityData('{{ city_name }}');
            
            // å¦‚æœGoogle Mapså·²ç»åŠ è½½ï¼Œç«‹å³åˆå§‹åŒ–åœ°å›¾
            if (typeof google !== 'undefined' && google.maps) {
                initCityMap('{{ city_name }}', {{ city_data.coordinates | tojson }});
            }
        });
        
        // é‡å†™Google Mapså›è°ƒå‡½æ•°ï¼Œç¡®ä¿åœ°å›¾æ­£ç¡®åˆå§‹åŒ–
         window.initMap = function() {
             console.log('Google Maps APIåŠ è½½å®Œæˆ');
             // åˆå§‹åŒ–åŸå¸‚åœ°å›¾
             initCityMap('{{ city_name }}', {{ city_data.coordinates | tojson }});
         };
    </script>
    
    <!-- Google Maps API - åœ¨initMapå‡½æ•°å®šä¹‰ååŠ è½½ -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap"></script>
</body>
</html>