<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ä¸­å¿ƒ - ç‚¹äº®ä¸­å›½</title>
    <meta name="description" content="ç‚¹äº®ä¸­å›½æ—…æ¸¸å¹³å°ç”¨æˆ·ä¸­å¿ƒï¼Œç®¡ç†ä¸ªäººä¿¡æ¯ã€æ”¶è—æ™¯ç‚¹ã€æ‰“å¡è®°å½•å’Œè¯„ä»·">
    <meta name="keywords" content="ç”¨æˆ·ä¸­å¿ƒ,ä¸ªäººä¿¡æ¯,æ”¶è—æ™¯ç‚¹,æ‰“å¡è®°å½•,æ—…æ¸¸è¯„ä»·,ç‚¹äº®ä¸­å›½">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('main.index') }}" class="logo">ğŸŒŸ ç‚¹äº®ä¸­å›½</a>
            
            <nav class="main-nav">
                <a href="{{ url_for('main.index') }}">é¦–é¡µ</a>
                <a href="#" class="active">ç”¨æˆ·ä¸­å¿ƒ</a>
                <a href="{{ url_for('volunteers.get_volunteer_services') }}">å¿—æ„¿æœåŠ¡</a>
            </nav>
            
            <div class="user-menu">
                <div class="user-info">
                    <img src="{{ current_user.avatar or '/static/images/default-avatar.jpg' }}" alt="å¤´åƒ" class="user-avatar" width="40" height="40">
                    <span class="username">{{ current_user.username }}</span>
                </div>
                <button class="btn btn-outline btn-sm" id="logoutBtn">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </header>

    <main class="user-center">
        <!-- ä¾§è¾¹æ å¯¼èˆª -->
        <aside class="sidebar">
            <div class="user-profile">
                <div class="profile-avatar">
                    <img src="{{ current_user.avatar or '/static/images/default-avatar.jpg' }}" alt="å¤´åƒ" id="avatarDisplay" width="100" height="100">
                    <button class="avatar-edit-btn" id="editAvatarBtn">ğŸ“·</button>
                </div>
                <h2 class="profile-name">{{ current_user.username }}</h2>
                <p class="profile-bio">{{ current_user.bio or 'è¿™ä¸ªäººå¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹...' }}</p>
                
                <!-- ç”¨æˆ·ç»Ÿè®¡ -->
                <div class="user-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ user_stats.checkins_count }}</div>
                        <div class="stat-label">æ‰“å¡æ¬¡æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user_stats.cities_visited }}</div>
                        <div class="stat-label">åˆ°è®¿åŸå¸‚</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user_stats.reviews_count }}</div>
                        <div class="stat-label">è¯„ä»·æ•°é‡</div>
                    </div>
                </div>
                
                <!-- æˆå°±å¾½ç«  -->
                <div class="achievements">
                    <h3>ğŸ† æˆå°±å¾½ç« </h3>
                    <div class="badges-grid">
                        {% for badge in user_badges %}
                        <div class="badge-item {{ 'earned' if badge.earned else 'locked' }}" title="{{ badge.description }}">
                            <span class="badge-icon">{{ badge.icon }}</span>
                            <span class="badge-name">{{ badge.name }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- å¯¼èˆªèœå• -->
            <nav class="sidebar-nav">
                <a href="#profile" class="nav-item active" data-tab="profile">
                    <span class="nav-icon">ğŸ‘¤</span>
                    <span class="nav-text">ä¸ªäººä¿¡æ¯</span>
                </a>
                <a href="#favorites" class="nav-item" data-tab="favorites">
                    <span class="nav-icon">â¤ï¸</span>
                    <span class="nav-text">æˆ‘çš„æ”¶è—</span>
                </a>
                <a href="#routes" class="nav-item" data-tab="routes">
                    <span class="nav-icon">ğŸ—ºï¸</span>
                    <span class="nav-text">è¡Œç¨‹è®¡åˆ’</span>
                </a>
                <a href="#checkins" class="nav-item" data-tab="checkins">
                    <span class="nav-icon">ğŸ“¸</span>
                    <span class="nav-text">æ‰“å¡è®°å½•</span>
                </a>
                <a href="#reviews" class="nav-item" data-tab="reviews">
                    <span class="nav-icon">ğŸ’¬</span>
                    <span class="nav-text">æˆ‘çš„è¯„ä»·</span>
                </a>
                {% if current_user.is_volunteer %}
                <a href="#volunteer" class="nav-item" data-tab="volunteer">
                    <span class="nav-icon">ğŸ¤</span>
                    <span class="nav-text">å¿—æ„¿æœåŠ¡</span>
                </a>
                {% endif %}
                <a href="#settings" class="nav-item" data-tab="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">è´¦æˆ·è®¾ç½®</span>
                </a>
            </nav>
        </aside>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- ä¸ªäººä¿¡æ¯æ ‡ç­¾é¡µ -->
            <div id="profile" class="tab-content active">
                <div class="content-header">
                    <h2>ğŸ‘¤ ä¸ªäººä¿¡æ¯</h2>
                    <button class="btn btn-primary" id="editProfileBtn">ç¼–è¾‘èµ„æ–™</button>
                </div>
                
                <div class="profile-form">
                    <form id="profileForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>ç”¨æˆ·å</label>
                                <input type="text" id="username" name="username" value="{{ current_user.username }}" readonly>
                            </div>
                            <div class="form-group">
                                <label>é‚®ç®±</label>
                                <input type="email" id="email" name="email" value="{{ current_user.email }}" readonly>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>æ‰‹æœºå·</label>
                                <input type="tel" id="phone" name="phone" value="{{ current_user.phone or '' }}" readonly>
                            </div>
                            <div class="form-group">
                                <label>æ€§åˆ«</label>
                                <select id="gender" name="gender" disabled>
                                    <option value="">è¯·é€‰æ‹©</option>
                                    <option value="male" {{ 'selected' if current_user.gender == 'male' else '' }}>ç”·</option>
                                    <option value="female" {{ 'selected' if current_user.gender == 'female' else '' }}>å¥³</option>
                                    <option value="other" {{ 'selected' if current_user.gender == 'other' else '' }}>å…¶ä»–</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>ä¸ªäººç®€ä»‹</label>
                            <textarea id="bio" name="bio" rows="3" readonly>{{ current_user.bio or '' }}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>å…´è¶£æ ‡ç­¾</label>
                            <div class="interests-tags">
                                {% for interest in user_interests %}
                                <span class="interest-tag">{{ interest }}</span>
                                {% endfor %}
                                <button type="button" class="add-interest-btn hidden" id="addInterestBtn">+ æ·»åŠ æ ‡ç­¾</button>
                            </div>
                        </div>
                        
                        <div class="form-actions hidden">
                            <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                            <button type="button" class="btn btn-secondary" id="cancelEditBtn">å–æ¶ˆ</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- æˆ‘çš„æ”¶è—æ ‡ç­¾é¡µ -->
            <div id="favorites" class="tab-content">
                <div class="content-header">
                    <h2>â¤ï¸ æˆ‘çš„æ”¶è—</h2>
                    <div class="filter-tabs">
                        <button class="filter-tab active" data-filter="all">å…¨éƒ¨</button>
                        <button class="filter-tab" data-filter="cities">åŸå¸‚</button>
                        <button class="filter-tab" data-filter="attractions">æ™¯ç‚¹</button>
                        <button class="filter-tab" data-filter="routes">è·¯çº¿</button>
                    </div>
                </div>
                
                <div class="favorites-grid">
                    {% for favorite in user_favorites %}
                    <div class="favorite-card" data-type="{{ favorite.type }}">
                        <div class="card-image">
                            <img src="{{ favorite.image or '/static/images/default-attraction.jpg' }}" alt="{{ favorite.name }}" width="200" height="150">
                            <button class="unfavorite-btn" onclick="removeFavorite({{ favorite.id }}, '{{ favorite.type }}')">
                                â¤ï¸
                            </button>
                        </div>
                        <div class="card-content">
                            <h3 class="card-title">{{ favorite.name }}</h3>
                            <p class="card-description">{{ favorite.description[:60] }}...</p>
                            <div class="card-meta">
                                <span class="card-type">{{ favorite.type_name }}</span>
                                {% if favorite.rating %}
                                <span class="card-rating">â­ {{ favorite.rating }}</span>
                                {% endif %}
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-primary" onclick="viewDetail('{{ favorite.type }}', {{ favorite.id }})">æŸ¥çœ‹è¯¦æƒ…</button>
                                <button class="btn btn-sm btn-outline" onclick="addToRoute({{ favorite.id }})">åŠ å…¥è¡Œç¨‹</button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- è¡Œç¨‹è®¡åˆ’æ ‡ç­¾é¡µ -->
            <div id="routes" class="tab-content">
                <div class="content-header">
                    <h2>ğŸ—ºï¸ è¡Œç¨‹è®¡åˆ’</h2>
                    <button class="btn btn-primary" id="createRouteBtn">+ åˆ›å»ºæ–°è¡Œç¨‹</button>
                </div>
                
                <div class="routes-list">
                    {% for route in user_routes %}
                    <div class="route-card">
                        <div class="route-header">
                            <div class="route-info">
                                <h3 class="route-title">{{ route.title }}</h3>
                                <p class="route-description">{{ route.description }}</p>
                                <div class="route-meta">
                                    <span class="route-duration">ğŸ•’ {{ route.duration }}å¤©</span>
                                    <span class="route-cities">ğŸ“ {{ route.cities_count }}ä¸ªåŸå¸‚</span>
                                    <span class="route-status status-{{ route.status }}">{{ route.status_name }}</span>
                                </div>
                            </div>
                            <div class="route-actions">
                                <button class="btn btn-sm btn-outline" onclick="editRoute({{ route.id }})">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-primary" onclick="viewRoute({{ route.id }})">æŸ¥çœ‹</button>
                            </div>
                        </div>
                        
                        <div class="route-timeline">
                            {% for day in route.days[:3] %}
                            <div class="timeline-day">
                                <div class="day-number">Day {{ loop.index }}</div>
                                <div class="day-attractions">
                                    {% for attraction in day.attractions[:2] %}
                                    <span class="attraction-tag">{{ attraction.name }}</span>
                                    {% endfor %}
                                    {% if day.attractions|length > 2 %}
                                    <span class="more-tag">+{{ day.attractions|length - 2 }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                            {% if route.days|length > 3 %}
                            <div class="timeline-more">...</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- æ‰“å¡è®°å½•æ ‡ç­¾é¡µ -->
            <div id="checkins" class="tab-content">
                <div class="content-header">
                    <h2>ğŸ“¸ æ‰“å¡è®°å½•</h2>
                    <div class="view-toggle">
                        <button class="toggle-btn active" data-view="grid">ğŸ”² ç½‘æ ¼</button>
                        <button class="toggle-btn" data-view="map">ğŸ—ºï¸ åœ°å›¾</button>
                    </div>
                </div>
                
                <!-- ç½‘æ ¼è§†å›¾ -->
                <div class="checkins-grid view-grid active">
                    {% for checkin in user_checkins %}
                    <div class="checkin-card">
                        <div class="checkin-image">
                            <img src="{{ checkin.image }}" alt="{{ checkin.attraction_name }}" width="200" height="150">
                            <div class="checkin-date">{{ checkin.created_at.strftime('%m-%d') }}</div>
                        </div>
                        <div class="checkin-info">
                            <h4 class="checkin-title">{{ checkin.attraction_name }}</h4>
                            <p class="checkin-location">ğŸ“ {{ checkin.city_name }}</p>
                            {% if checkin.message %}
                            <p class="checkin-message">{{ checkin.message }}</p>
                            {% endif %}
                            <div class="checkin-actions">
                                <button class="action-btn" onclick="shareCheckin({{ checkin.id }})">
                                    ğŸ“¤ åˆ†äº«
                                </button>
                                <button class="action-btn" onclick="deleteCheckin({{ checkin.id }})">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- åœ°å›¾è§†å›¾ -->
                <div class="checkins-map view-map">
                    <div id="checkinsMapContainer" class="map-container"></div>
                </div>
            </div>

            <!-- æˆ‘çš„è¯„ä»·æ ‡ç­¾é¡µ -->
            <div id="reviews" class="tab-content">
                <div class="content-header">
                    <h2>ğŸ’¬ æˆ‘çš„è¯„ä»·</h2>
                    <div class="reviews-stats">
                        <div class="stat-item">
                            <span class="stat-number">{{ user_stats.reviews_count }}</span>
                            <span class="stat-label">æ€»è¯„ä»·æ•°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ user_stats.avg_rating }}</span>
                            <span class="stat-label">å¹³å‡è¯„åˆ†</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ user_stats.helpful_votes }}</span>
                            <span class="stat-label">è·å¾—ç‚¹èµ</span>
                        </div>
                    </div>
                </div>
                
                <div class="reviews-list">
                    {% for review in user_reviews %}
                    <div class="review-card">
                        <div class="review-header">
                            <div class="attraction-info">
                                <img src="{{ review.attraction.image }}" alt="{{ review.attraction.name }}" class="attraction-thumb" width="60" height="60">
                                <div class="attraction-details">
                                    <h4 class="attraction-name">{{ review.attraction.name }}</h4>
                                    <p class="attraction-location">{{ review.attraction.city }}</p>
                                </div>
                            </div>
                            <div class="review-meta">
                                <div class="review-rating">
                                    {% for i in range(5) %}
                                    <span class="star {{ 'filled' if i < review.rating else '' }}">â­</span>
                                    {% endfor %}
                                </div>
                                <div class="review-date">{{ review.created_at.strftime('%Y-%m-%d') }}</div>
                            </div>
                        </div>
                        
                        <div class="review-content">
                            <p>{{ review.content }}</p>
                            {% if review.images %}
                            <div class="review-images">
                                {% for image in review.images %}
                                <img src="{{ image }}" alt="è¯„ä»·å›¾ç‰‡" class="review-image" width="80" height="80">
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="review-stats">
                            <span class="stat-item">ğŸ‘ {{ review.likes_count }} ç‚¹èµ</span>
                            <span class="stat-item">ğŸ’¬ {{ review.replies_count }} å›å¤</span>
                            <div class="review-actions">
                                <button class="btn btn-sm btn-outline" onclick="editReview({{ review.id }})">ç¼–è¾‘</button>
                                <button class="btn btn-sm btn-outline" onclick="deleteReview({{ review.id }})">åˆ é™¤</button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- å¿—æ„¿æœåŠ¡æ ‡ç­¾é¡µ -->
            {% if current_user.is_volunteer %}
            <div id="volunteer" class="tab-content">
                <div class="content-header">
                    <h2>ğŸ¤ å¿—æ„¿æœåŠ¡</h2>
                    <div class="volunteer-stats">
                        <div class="stat-item">
                            <span class="stat-number">{{ volunteer_stats.total_hours }}</span>
                            <span class="stat-label">æœåŠ¡æ—¶é•¿(å°æ—¶)</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ volunteer_stats.served_users }}</span>
                            <span class="stat-label">æœåŠ¡äººæ•°</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">{{ volunteer_stats.rating }}</span>
                            <span class="stat-label">æœåŠ¡è¯„åˆ†</span>
                        </div>
                    </div>
                </div>
                
                <div class="volunteer-content">
                    <!-- æœåŠ¡è®°å½• -->
                    <div class="service-records">
                        <h3>ğŸ“‹ æœåŠ¡è®°å½•</h3>
                        <div class="records-list">
                            {% for record in volunteer_records %}
                            <div class="record-card">
                                <div class="record-header">
                                    <div class="service-info">
                                        <h4>{{ record.service_type }}</h4>
                                        <p>æœåŠ¡å¯¹è±¡ï¼š{{ record.client_name }}</p>
                                        <p>æœåŠ¡æ—¶é—´ï¼š{{ record.service_date.strftime('%Y-%m-%d %H:%M') }}</p>
                                    </div>
                                    <div class="service-status">
                                        <span class="status-badge status-{{ record.status }}">{{ record.status_name }}</span>
                                    </div>
                                </div>
                                
                                <div class="record-content">
                                    <p>{{ record.description }}</p>
                                    {% if record.feedback %}
                                    <div class="client-feedback">
                                        <h5>ç”¨æˆ·åé¦ˆï¼š</h5>
                                        <p>{{ record.feedback }}</p>
                                        <div class="feedback-rating">
                                            {% for i in range(5) %}
                                            <span class="star {{ 'filled' if i < record.rating else '' }}">â­</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- å¯ç”¨æ—¶é—´è®¾ç½® -->
                    <div class="availability-settings">
                        <h3>â° å¯ç”¨æ—¶é—´è®¾ç½®</h3>
                        <div class="availability-form">
                            <form id="availabilityForm">
                                <div class="time-slots">
                                    {% for day in ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'] %}
                                    <div class="day-slot">
                                        <label class="day-label">{{ day }}</label>
                                        <div class="time-inputs">
                                            <input type="time" name="{{ day }}_start" value="09:00">
                                            <span>-</span>
                                            <input type="time" name="{{ day }}_end" value="18:00">
                                            <label class="checkbox-label">
                                                <input type="checkbox" name="{{ day }}_available" checked>
                                                å¯ç”¨
                                            </label>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- è´¦æˆ·è®¾ç½®æ ‡ç­¾é¡µ -->
            <div id="settings" class="tab-content">
                <div class="content-header">
                    <h2>âš™ï¸ è´¦æˆ·è®¾ç½®</h2>
                </div>
                
                <div class="settings-sections">
                    <!-- éšç§è®¾ç½® -->
                    <div class="settings-section">
                        <h3>ğŸ”’ éšç§è®¾ç½®</h3>
                        <div class="settings-form">
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="profilePublic" {{ 'checked' if current_user.profile_public else '' }}>
                                    å…¬å¼€ä¸ªäººèµ„æ–™
                                </label>
                                <p class="setting-description">å…¶ä»–ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‚¨çš„åŸºæœ¬ä¿¡æ¯å’Œæ‰“å¡è®°å½•</p>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="showLocation" {{ 'checked' if current_user.show_location else '' }}>
                                    æ˜¾ç¤ºä½ç½®ä¿¡æ¯
                                </label>
                                <p class="setting-description">åœ¨æ‰“å¡å’Œè¯„ä»·ä¸­æ˜¾ç¤ºæ‚¨çš„ä½ç½®ä¿¡æ¯</p>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="allowMessages" {{ 'checked' if current_user.allow_messages else '' }}>
                                    å…è®¸ç§ä¿¡
                                </label>
                                <p class="setting-description">å…¶ä»–ç”¨æˆ·å¯ä»¥å‘æ‚¨å‘é€ç§ä¿¡</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- é€šçŸ¥è®¾ç½® -->
                    <div class="settings-section">
                        <h3>ğŸ”” é€šçŸ¥è®¾ç½®</h3>
                        <div class="settings-form">
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="emailNotifications" {{ 'checked' if current_user.email_notifications else '' }}>
                                    é‚®ä»¶é€šçŸ¥
                                </label>
                                <p class="setting-description">æ¥æ”¶é‡è¦æ›´æ–°å’Œæ´»åŠ¨é€šçŸ¥é‚®ä»¶</p>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">
                                    <input type="checkbox" id="pushNotifications" {{ 'checked' if current_user.push_notifications else '' }}>
                                    æ¨é€é€šçŸ¥
                                </label>
                                <p class="setting-description">æ¥æ”¶æµè§ˆå™¨æ¨é€é€šçŸ¥</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å®‰å…¨è®¾ç½® -->
                    <div class="settings-section">
                        <h3>ğŸ›¡ï¸ å®‰å…¨è®¾ç½®</h3>
                        <div class="settings-form">
                            <div class="setting-item">
                                <label class="setting-label">ä¿®æ”¹å¯†ç </label>
                                <button class="btn btn-outline" id="changePasswordBtn">æ›´æ”¹å¯†ç </button>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">ä¸¤æ­¥éªŒè¯</label>
                                <button class="btn btn-outline" id="setup2FABtn">è®¾ç½®ä¸¤æ­¥éªŒè¯</button>
                            </div>
                            
                            <div class="setting-item">
                                <label class="setting-label">ç™»å½•è®¾å¤‡ç®¡ç†</label>
                                <button class="btn btn-outline" id="manageDevicesBtn">ç®¡ç†è®¾å¤‡</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ•°æ®ç®¡ç† -->
                    <div class="settings-section">
                        <h3>ğŸ“Š æ•°æ®ç®¡ç†</h3>
                        <div class="settings-form">
                            <div class="setting-item">
                                <label class="setting-label">å¯¼å‡ºæ•°æ®</label>
                                <button class="btn btn-outline" id="exportDataBtn">å¯¼å‡ºæˆ‘çš„æ•°æ®</button>
                                <p class="setting-description">ä¸‹è½½æ‚¨çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬</p>
                            </div>
                            
                            <div class="setting-item danger-zone">
                                <label class="setting-label">åˆ é™¤è´¦æˆ·</label>
                                <button class="btn btn-danger" id="deleteAccountBtn">åˆ é™¤è´¦æˆ·</button>
                                <p class="setting-description">æ°¸ä¹…åˆ é™¤æ‚¨çš„è´¦æˆ·å’Œæ‰€æœ‰æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åˆ›å»ºè¡Œç¨‹æ¨¡æ€æ¡† -->
    <div id="createRouteModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>ğŸ—ºï¸ åˆ›å»ºæ–°è¡Œç¨‹</h3>
                <button class="close-btn" id="closeCreateRouteModal">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="createRouteForm">
                    <div class="form-group">
                        <label>è¡Œç¨‹æ ‡é¢˜</label>
                        <input type="text" name="title" placeholder="ç»™æ‚¨çš„è¡Œç¨‹èµ·ä¸ªåå­—" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>å¼€å§‹æ—¥æœŸ</label>
                            <input type="date" name="start_date" required>
                        </div>
                        <div class="form-group">
                            <label>ç»“æŸæ—¥æœŸ</label>
                            <input type="date" name="end_date" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>è¡Œç¨‹æè¿°</label>
                        <textarea name="description" rows="3" placeholder="æè¿°ä¸€ä¸‹è¿™æ¬¡æ—…è¡Œçš„ä¸»é¢˜å’Œç›®æ ‡"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>ç›®çš„åœ°åŸå¸‚</label>
                        <div class="cities-selector">
                            <input type="text" id="citySearch" placeholder="æœç´¢å¹¶æ·»åŠ åŸå¸‚">
                            <div class="selected-cities" id="selectedCities"></div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">åˆ›å»ºè¡Œç¨‹</button>
                        <button type="button" class="btn btn-secondary" id="cancelCreateRoute">å–æ¶ˆ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/user.js') }}"></script>
    <script>
        // ç”¨æˆ·æ•°æ®
        const userData = {{ current_user | tojson }};
        const userStats = {{ user_stats | tojson }};
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ ‡ç­¾é¡µåˆ‡æ¢
            initTabSwitching();
            
            // åˆå§‹åŒ–ä¸ªäººèµ„æ–™ç¼–è¾‘
            initProfileEditing();
            
            // åˆå§‹åŒ–æ”¶è—ç®¡ç†
            initFavoritesManagement();
            
            // åˆå§‹åŒ–è¡Œç¨‹ç®¡ç†
            initRouteManagement();
            
            // åˆå§‹åŒ–æ‰“å¡è®°å½•
            initCheckinsDisplay();
            
            // åˆå§‹åŒ–è®¾ç½®
            initSettings();
            
            // åŠ è½½ç”¨æˆ·çŠ¶æ€
            loadUserData();
        });
    </script>
</body>
</html>