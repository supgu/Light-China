<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊêúÁ¥¢ÁªìÊûú - ÁÇπ‰∫Æ‰∏≠ÂõΩ</title>
    <meta name="description" content="ÁÇπ‰∫Æ‰∏≠ÂõΩÊóÖÊ∏∏Âπ≥Âè∞ÊêúÁ¥¢ÁªìÊûúÈ°µÈù¢ÔºåÊêúÁ¥¢ÂÖ®ÂõΩÊôØÁÇπ„ÄÅÁæéÈ£ü„ÄÅË∑ØÁ∫øÁ≠âÊóÖÊ∏∏‰ø°ÊÅØ">
    <meta name="keywords" content="ÊóÖÊ∏∏ÊêúÁ¥¢,ÊôØÁÇπÊêúÁ¥¢,ÁæéÈ£üÊêúÁ¥¢,Ë∑ØÁ∫øÊêúÁ¥¢,ÁÇπ‰∫Æ‰∏≠ÂõΩ">
    
    <!-- Ê†∑ÂºèÊñá‰ª∂ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">
</head>
<body>
    <!-- Â§¥ÈÉ®ÂØºËà™ -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('main.index') }}" class="logo">üåü ÁÇπ‰∫Æ‰∏≠ÂõΩ</a>
            
            <!-- ÊêúÁ¥¢Ê†è -->
            <div class="search-container">
                <form class="search-form" action="{{ url_for('main.search') }}" method="get">
                    <div class="search-input-group">
                        <input type="text" name="q" value="{{ query }}" placeholder="ÊêúÁ¥¢ÂüéÂ∏Ç„ÄÅÊôØÁÇπ„ÄÅÁæéÈ£ü..." class="search-input">
                        <button type="submit" class="search-btn">üîç</button>
                    </div>
                </form>
            </div>
            
            <nav class="main-nav">
                <a href="{{ url_for('main.index') }}">È¶ñÈ°µ</a>
                <a href="{{ url_for('volunteers.volunteer_service') }}">ÂøóÊÑøÊúçÂä°</a>
                <a href="{{ url_for('main.user_center') }}">Áî®Êà∑‰∏≠ÂøÉ</a>
            </nav>
            
            <div class="user-menu">
                {% if current_user.is_authenticated %}
                <div class="user-info">
                    <img src="{{ current_user.avatar or '/static/images/default-avatar.jpg' }}" alt="Â§¥ÂÉè" class="user-avatar" width="40" height="40">
                    <span class="username">{{ current_user.username }}</span>
                </div>
                {% else %}
                <button class="btn btn-primary" id="loginBtn">ÁôªÂΩï</button>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- ÊêúÁ¥¢ÁªìÊûúÈ°µÈù¢ -->
    <main class="search-results-page">
        <div class="container">
            <!-- ÊêúÁ¥¢‰ø°ÊÅØÊ†è -->
            <div class="search-info">
                <div class="search-summary">
                    <h1>ÊêúÁ¥¢ÁªìÊûú</h1>
                    <p class="search-query">ÂÖ≥ÈîÆËØçÔºö<strong>"{{ query }}"</strong></p>
                    <p class="results-count">ÊâæÂà∞ <strong>{{ total_results }}</strong> ‰∏™Áõ∏ÂÖ≥ÁªìÊûú</p>
                </div>
                
                <div class="search-suggestions">
                    {% if suggestions %}
                    <div class="suggestions">
                        <span class="suggestions-label">Áõ∏ÂÖ≥ÊêúÁ¥¢Ôºö</span>
                        {% for suggestion in suggestions %}
                        <a href="{{ url_for('main.search', q=suggestion) }}" class="suggestion-tag">{{ suggestion }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="search-content">
                <!-- Á≠õÈÄâ‰æßËæπÊ†è -->
                <aside class="filters-sidebar">
                    <div class="filters-header">
                        <h3>Á≠õÈÄâÊù°‰ª∂</h3>
                        <button class="clear-filters" id="clearFilters">Ê∏ÖÈô§ÂÖ®ÈÉ®</button>
                    </div>
                    
                    <!-- ÂÜÖÂÆπÁ±ªÂûãÁ≠õÈÄâ -->
                    <div class="filter-group">
                        <h4 class="filter-title">ÂÜÖÂÆπÁ±ªÂûã</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="all" {{ 'checked' if not filters.type or 'all' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                ÂÖ®ÈÉ® ({{ total_results }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="city" {{ 'checked' if 'city' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                ÂüéÂ∏Ç ({{ results_count.cities }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="attraction" {{ 'checked' if 'attraction' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                ÊôØÁÇπ ({{ results_count.attractions }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="food" {{ 'checked' if 'food' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                ÁæéÈ£ü ({{ results_count.foods }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="route" {{ 'checked' if 'route' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                Ë∑ØÁ∫ø ({{ results_count.routes }})
                            </label>
                        </div>
                    </div>
                    
                    <!-- Âú∞Âå∫Á≠õÈÄâ -->
                    <div class="filter-group">
                        <h4 class="filter-title">Âú∞Âå∫</h4>
                        <div class="filter-options">
                            {% for region in popular_regions %}
                            <label class="filter-option">
                                <input type="checkbox" name="region" value="{{ region.code }}" {{ 'checked' if region.code in filters.region else '' }}>
                                <span class="checkmark"></span>
                                {{ region.name }} ({{ region.count }})
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- ËØÑÂàÜÁ≠õÈÄâ -->
                    <div class="filter-group">
                        <h4 class="filter-title">ËØÑÂàÜ</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="radio" name="rating" value="all" {{ 'checked' if not filters.rating or filters.rating == 'all' else '' }}>
                                <span class="radiomark"></span>
                                ÂÖ®ÈÉ®ËØÑÂàÜ
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="rating" value="4.5" {{ 'checked' if filters.rating == '4.5' else '' }}>
                                <span class="radiomark"></span>
                                4.5ÂàÜ‰ª•‰∏ä ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="rating" value="4.0" {{ 'checked' if filters.rating == '4.0' else '' }}>
                                <span class="radiomark"></span>
                                4.0ÂàÜ‰ª•‰∏ä ‚≠ê‚≠ê‚≠ê‚≠ê
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="rating" value="3.5" {{ 'checked' if filters.rating == '3.5' else '' }}>
                                <span class="radiomark"></span>
                                3.5ÂàÜ‰ª•‰∏ä ‚≠ê‚≠ê‚≠ê
                            </label>
                        </div>
                    </div>
                    
                    <!-- ‰ª∑Ê†ºÁ≠õÈÄâ -->
                    <div class="filter-group">
                        <h4 class="filter-title">‰ª∑Ê†ºËåÉÂõ¥</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="radio" name="price" value="all" {{ 'checked' if not filters.price or filters.price == 'all' else '' }}>
                                <span class="radiomark"></span>
                                ‰∏çÈôê
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="free" {{ 'checked' if filters.price == 'free' else '' }}>
                                <span class="radiomark"></span>
                                ÂÖçË¥π
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="low" {{ 'checked' if filters.price == 'low' else '' }}>
                                <span class="radiomark"></span>
                                ¬•50‰ª•‰∏ã
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="medium" {{ 'checked' if filters.price == 'medium' else '' }}>
                                <span class="radiomark"></span>
                                ¬•50-200
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="high" {{ 'checked' if filters.price == 'high' else '' }}>
                                <span class="radiomark"></span>
                                ¬•200‰ª•‰∏ä
                            </label>
                        </div>
                    </div>
                    
                    <!-- ÁâπËâ≤Ê†áÁ≠æ -->
                    <div class="filter-group">
                        <h4 class="filter-title">ÁâπËâ≤Ê†áÁ≠æ</h4>
                        <div class="filter-options">
                            {% for tag in popular_tags %}
                            <label class="filter-option">
                                <input type="checkbox" name="tags" value="{{ tag.name }}" {{ 'checked' if tag.name in filters.tags else '' }}>
                                <span class="checkmark"></span>
                                {{ tag.name }} ({{ tag.count }})
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </aside>

                <!-- ÊêúÁ¥¢ÁªìÊûú‰∏ª‰Ωì -->
                <div class="results-main">
                    <!-- ÊéíÂ∫èÂíåËßÜÂõæÊéßÂà∂ -->
                    <div class="results-controls">
                        <div class="sort-options">
                            <label>ÊéíÂ∫èÊñπÂºèÔºö</label>
                            <select name="sort" id="sortSelect">
                                <option value="relevance" {{ 'selected' if sort == 'relevance' else '' }}>Áõ∏ÂÖ≥Â∫¶</option>
                                <option value="rating" {{ 'selected' if sort == 'rating' else '' }}>ËØÑÂàÜ</option>
                                <option value="popularity" {{ 'selected' if sort == 'popularity' else '' }}>ÁÉ≠Â∫¶</option>
                                <option value="distance" {{ 'selected' if sort == 'distance' else '' }}>Ë∑ùÁ¶ª</option>
                                <option value="price_low" {{ 'selected' if sort == 'price_low' else '' }}>‰ª∑Ê†º‰ªé‰ΩéÂà∞È´ò</option>
                                <option value="price_high" {{ 'selected' if sort == 'price_high' else '' }}>‰ª∑Ê†º‰ªéÈ´òÂà∞‰Ωé</option>
                                <option value="newest" {{ 'selected' if sort == 'newest' else '' }}>ÊúÄÊñ∞</option>
                            </select>
                        </div>
                        
                        <div class="view-options">
                            <button class="view-btn {{ 'active' if view_mode == 'list' else '' }}" data-view="list">üìã</button>
                            <button class="view-btn {{ 'active' if view_mode == 'grid' else '' }}" data-view="grid">‚äû</button>
                            <button class="view-btn {{ 'active' if view_mode == 'map' else '' }}" data-view="map">üó∫Ô∏è</button>
                        </div>
                    </div>

                    <!-- ÊêúÁ¥¢ÁªìÊûúÂàóË°® -->
                    <div class="results-container" id="resultsContainer">
                        {% if results %}
                        <div class="results-list {{ view_mode }}">
                            {% for result in results %}
                            <div class="result-item {{ result.type }}" data-type="{{ result.type }}" data-id="{{ result.id }}">
                                <div class="result-image">
                                    <img src="{{ result.image or '/static/images/default-' + result.type + '.jpg' }}" alt="{{ result.title }}" width="300" height="200">
                                    <div class="result-type-badge">{{ result.type_label }}</div>
                                    {% if result.is_featured %}
                                    <div class="featured-badge">Êé®Ëçê</div>
                                    {% endif %}
                                </div>
                                
                                <div class="result-content">
                                    <div class="result-header">
                                        <h3 class="result-title">
                                            <a href="{{ result.url }}">{{ result.title | highlight(query) | safe }}</a>
                                        </h3>
                                        
                                        <div class="result-rating">
                                            {% if result.rating %}
                                            <div class="stars">
                                                {% for i in range(5) %}
                                                <span class="star {{ 'filled' if i < result.rating else '' }}">‚≠ê</span>
                                                {% endfor %}
                                            </div>
                                            <span class="rating-text">{{ result.rating }} ({{ result.reviews_count }}Êù°ËØÑ‰ª∑)</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="result-info">
                                        <div class="result-location">
                                            üìç {{ result.location }}
                                        </div>
                                        
                                        {% if result.price %}
                                        <div class="result-price">
                                            {% if result.price == 0 %}
                                            <span class="price-free">ÂÖçË¥π</span>
                                            {% else %}
                                            <span class="price-value">¬•{{ result.price }}</span>
                                            {% if result.original_price and result.original_price > result.price %}
                                            <span class="price-original">¬•{{ result.original_price }}</span>
                                            {% endif %}
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                        
                                        {% if result.distance %}
                                        <div class="result-distance">
                                            üöó {{ result.distance }}km
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="result-description">
                                        <p>{{ result.description | highlight(query) | safe | truncate(150) }}</p>
                                    </div>
                                    
                                    <div class="result-tags">
                                        {% for tag in result.tags %}
                                        <span class="tag">{{ tag }}</span>
                                        {% endfor %}
                                    </div>
                                    
                                    <div class="result-actions">
                                        <a href="{{ result.url }}" class="btn btn-primary">Êü•ÁúãËØ¶ÊÉÖ</a>
                                        <button class="btn btn-outline" onclick="addToFavorites({{ result.id }}, '{{ result.type }}')">‚ù§Ô∏è Êî∂Ëóè</button>
                                        {% if result.type == 'attraction' %}
                                        <button class="btn btn-outline" onclick="planRoute({{ result.id }})">üó∫Ô∏è Ë∑ØÁ∫ø</button>
                                        {% endif %}
                                        <button class="btn btn-outline" onclick="shareResult({{ result.id }})">üì§ ÂàÜ‰∫´</button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- ÂàÜÈ°µ -->
                        {% if pagination.pages > 1 %}
                        <div class="pagination">
                            {% if pagination.has_prev %}
                            <a href="{{ url_for('main.search', q=query, page=pagination.prev_num, **request.args) }}" class="page-btn prev">‰∏ä‰∏ÄÈ°µ</a>
                            {% endif %}
                            
                            {% for page_num in pagination.iter_pages() %}
                            {% if page_num %}
                            {% if page_num != pagination.page %}
                            <a href="{{ url_for('main.search', q=query, page=page_num, **request.args) }}" class="page-btn">{{ page_num }}</a>
                            {% else %}
                            <span class="page-btn active">{{ page_num }}</span>
                            {% endif %}
                            {% else %}
                            <span class="page-btn ellipsis">‚Ä¶</span>
                            {% endif %}
                            {% endfor %}
                            
                            {% if pagination.has_next %}
                            <a href="{{ url_for('main.search', q=query, page=pagination.next_num, **request.args) }}" class="page-btn next">‰∏ã‰∏ÄÈ°µ</a>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% else %}
                        <!-- Êó†ÊêúÁ¥¢ÁªìÊûú -->
                        <div class="no-results">
                            <div class="no-results-icon">üîç</div>
                            <h3>Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥ÁªìÊûú</h3>
                            <p>Êä±Ê≠âÔºåÊ≤°ÊúâÊâæÂà∞‰∏é "{{ query }}" Áõ∏ÂÖ≥ÁöÑÂÜÖÂÆπ</p>
                            
                            <div class="search-suggestions">
                                <h4>ÊêúÁ¥¢Âª∫ËÆÆÔºö</h4>
                                <ul>
                                    <li>Ê£ÄÊü•ËæìÂÖ•ÁöÑÂÖ≥ÈîÆËØçÊòØÂê¶Ê≠£Á°Æ</li>
                                    <li>Â∞ùËØï‰ΩøÁî®Êõ¥ÈÄöÁî®ÁöÑÂÖ≥ÈîÆËØç</li>
                                    <li>ÂáèÂ∞ëÁ≠õÈÄâÊù°‰ª∂</li>
                                    <li>Â∞ùËØïÊêúÁ¥¢Áõ∏ÂÖ≥ÁöÑÂüéÂ∏ÇÊàñÊôØÁÇπÂêçÁß∞</li>
                                </ul>
                            </div>
                            
                            <div class="popular-searches">
                                <h4>ÁÉ≠Èó®ÊêúÁ¥¢Ôºö</h4>
                                <div class="popular-tags">
                                    {% for popular in popular_searches %}
                                    <a href="{{ url_for('main.search', q=popular) }}" class="popular-tag">{{ popular }}</a>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <div class="no-results-actions">
                                <a href="{{ url_for('main.index') }}" class="btn btn-primary">ËøîÂõûÈ¶ñÈ°µ</a>
                                <button class="btn btn-outline" onclick="clearSearch()">ÈáçÊñ∞ÊêúÁ¥¢</button>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Âú∞ÂõæËßÜÂõæ -->
                    <div class="map-view hidden" id="mapView">
                    <div id="searchMap" class="search-map"></div>
                        <div class="map-controls">
                            <button class="btn btn-outline" id="centerMapBtn">üìç Â±Ö‰∏≠ÊòæÁ§∫</button>
                            <button class="btn btn-outline" id="clusterToggleBtn">üîó ËÅöÂêàÊòæÁ§∫</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- È°µËÑö -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>ÂÖ≥‰∫éÊàë‰ª¨</h4>
                    <p>ÁÇπ‰∫Æ‰∏≠ÂõΩËá¥Âäõ‰∫é‰∏∫ÊØè‰∏™‰∫∫Êèê‰æõÁæéÂ•ΩÁöÑÊóÖË°å‰ΩìÈ™å</p>
                </div>
                <div class="footer-section">
                    <h4>ËÅîÁ≥ªÊàë‰ª¨</h4>
                    <p>ÈÇÆÁÆ±Ôºöcontact@lightchina.com</p>
                    <p>ÁîµËØùÔºö400-123-4567</p>
                </div>
                <div class="footer-section">
                    <h4>ÂèãÊÉÖÈìæÊé•</h4>
                    <a href="#">ÊóÖÊ∏∏Â±ÄÂÆòÁΩë</a>
                    <a href="#">Êó†ÈöúÁ¢çÊóÖÊ∏∏Âçè‰ºö</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2024 ÁÇπ‰∫Æ‰∏≠ÂõΩ. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY"></script>
    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
    <script>
        // È°µÈù¢Êï∞ÊçÆ
        const searchData = {
            query: {{ query | tojson }},
            results: {{ results | tojson }},
            filters: {{ filters | tojson }},
            totalResults: {{ total_results }},
            currentPage: {{ pagination.page if pagination else 1 }}
        };
        
        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩ
            initSearchResults();
            
            // ÂàùÂßãÂåñÁ≠õÈÄâÂô®
            initFilters();
            
            // ÂàùÂßãÂåñÊéíÂ∫è
            initSorting();
            
            // ÂàùÂßãÂåñËßÜÂõæÂàáÊç¢
            initViewToggle();
            
            // ÂàùÂßãÂåñÂú∞Âõæ
            if (searchData.results.length > 0) {
                initSearchMap();
            }
            
            // ÂàùÂßãÂåñ‰∫§‰∫íÂäüËÉΩ
            initInteractions();
        });
    </script>
</body>
</html>