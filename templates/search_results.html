<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœç´¢ç»“æœ - ç‚¹äº®ä¸­å›½</title>
    <meta name="description" content="ç‚¹äº®ä¸­å›½æ—…æ¸¸å¹³å°æœç´¢ç»“æœé¡µé¢ï¼Œæœç´¢å…¨å›½æ™¯ç‚¹ã€ç¾é£Ÿã€è·¯çº¿ç­‰æ—…æ¸¸ä¿¡æ¯">
    <meta name="keywords" content="æ—…æ¸¸æœç´¢,æ™¯ç‚¹æœç´¢,ç¾é£Ÿæœç´¢,è·¯çº¿æœç´¢,ç‚¹äº®ä¸­å›½">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-content">
            <a href="{{ url_for('main.index') }}" class="logo">ğŸŒŸ ç‚¹äº®ä¸­å›½</a>
            
            <!-- æœç´¢æ  -->
            <div class="search-container">
                <form class="search-form" action="{{ url_for('main.search') }}" method="get">
                    <div class="search-input-group">
                        <input type="text" name="q" value="{{ query }}" placeholder="æœç´¢åŸå¸‚ã€æ™¯ç‚¹ã€ç¾é£Ÿ..." class="search-input">
                        <button type="submit" class="search-btn">ğŸ”</button>
                    </div>
                </form>
            </div>
            
            <nav class="main-nav">
                <a href="{{ url_for('main.index') }}">é¦–é¡µ</a>
                <a href="{{ url_for('volunteers.volunteer_service') }}">å¿—æ„¿æœåŠ¡</a>
                <a href="{{ url_for('main.user_center') }}">ç”¨æˆ·ä¸­å¿ƒ</a>
            </nav>
            
            <div class="user-menu">
                {% if current_user.is_authenticated %}
                <div class="user-info">
                    <img src="{{ current_user.avatar or '/static/images/default-avatar.jpg' }}" alt="å¤´åƒ" class="user-avatar" width="40" height="40">
                    <span class="username">{{ current_user.username }}</span>
                </div>
                {% else %}
                <button class="btn btn-primary" id="loginBtn">ç™»å½•</button>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- æœç´¢ç»“æœé¡µé¢ -->
    <main class="search-results-page">
        <div class="container">
            <!-- æœç´¢ä¿¡æ¯æ  -->
            <div class="search-info">
                <div class="search-summary">
                    <h1>æœç´¢ç»“æœ</h1>
                    <p class="search-query">å…³é”®è¯ï¼š<strong>"{{ query }}"</strong></p>
                    <p class="results-count">æ‰¾åˆ° <strong>{{ total_results }}</strong> ä¸ªç›¸å…³ç»“æœ</p>
                </div>
                
                <div class="search-suggestions">
                    {% if suggestions %}
                    <div class="suggestions">
                        <span class="suggestions-label">ç›¸å…³æœç´¢ï¼š</span>
                        {% for suggestion in suggestions %}
                        <a href="{{ url_for('main.search', q=suggestion) }}" class="suggestion-tag">{{ suggestion }}</a>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="search-content">
                <!-- ç­›é€‰ä¾§è¾¹æ  -->
                <aside class="filters-sidebar">
                    <div class="filters-header">
                        <h3>ç­›é€‰æ¡ä»¶</h3>
                        <button class="clear-filters" id="clearFilters">æ¸…é™¤å…¨éƒ¨</button>
                    </div>
                    
                    <!-- å†…å®¹ç±»å‹ç­›é€‰ -->
                    <div class="filter-group">
                        <h4 class="filter-title">å†…å®¹ç±»å‹</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="all" {{ 'checked' if not filters.type or 'all' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                å…¨éƒ¨ ({{ total_results }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="city" {{ 'checked' if 'city' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                åŸå¸‚ ({{ results_count.cities }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="attraction" {{ 'checked' if 'attraction' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                æ™¯ç‚¹ ({{ results_count.attractions }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="food" {{ 'checked' if 'food' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                ç¾é£Ÿ ({{ results_count.foods }})
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="type" value="route" {{ 'checked' if 'route' in filters.type else '' }}>
                                <span class="checkmark"></span>
                                è·¯çº¿ ({{ results_count.routes }})
                            </label>
                        </div>
                    </div>
                    
                    <!-- åœ°åŒºç­›é€‰ -->
                    <div class="filter-group">
                        <h4 class="filter-title">åœ°åŒº</h4>
                        <div class="filter-options">
                            {% for region in popular_regions %}
                            <label class="filter-option">
                                <input type="checkbox" name="region" value="{{ region.code }}" {{ 'checked' if region.code in filters.region else '' }}>
                                <span class="checkmark"></span>
                                {{ region.name }} ({{ region.count }})
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- è¯„åˆ†ç­›é€‰ -->
                    <div class="filter-group">
                        <h4 class="filter-title">è¯„åˆ†</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="radio" name="rating" value="all" {{ 'checked' if not filters.rating or filters.rating == 'all' else '' }}>
                                <span class="radiomark"></span>
                                å…¨éƒ¨è¯„åˆ†
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="rating" value="4.5" {{ 'checked' if filters.rating == '4.5' else '' }}>
                                <span class="radiomark"></span>
                                4.5åˆ†ä»¥ä¸Š â­â­â­â­â­
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="rating" value="4.0" {{ 'checked' if filters.rating == '4.0' else '' }}>
                                <span class="radiomark"></span>
                                4.0åˆ†ä»¥ä¸Š â­â­â­â­
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="rating" value="3.5" {{ 'checked' if filters.rating == '3.5' else '' }}>
                                <span class="radiomark"></span>
                                3.5åˆ†ä»¥ä¸Š â­â­â­
                            </label>
                        </div>
                    </div>
                    
                    <!-- ä»·æ ¼ç­›é€‰ -->
                    <div class="filter-group">
                        <h4 class="filter-title">ä»·æ ¼èŒƒå›´</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="radio" name="price" value="all" {{ 'checked' if not filters.price or filters.price == 'all' else '' }}>
                                <span class="radiomark"></span>
                                ä¸é™
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="free" {{ 'checked' if filters.price == 'free' else '' }}>
                                <span class="radiomark"></span>
                                å…è´¹
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="low" {{ 'checked' if filters.price == 'low' else '' }}>
                                <span class="radiomark"></span>
                                Â¥50ä»¥ä¸‹
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="medium" {{ 'checked' if filters.price == 'medium' else '' }}>
                                <span class="radiomark"></span>
                                Â¥50-200
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="high" {{ 'checked' if filters.price == 'high' else '' }}>
                                <span class="radiomark"></span>
                                Â¥200ä»¥ä¸Š
                            </label>
                        </div>
                    </div>
                    
                    <!-- ç‰¹è‰²æ ‡ç­¾ -->
                    <div class="filter-group">
                        <h4 class="filter-title">ç‰¹è‰²æ ‡ç­¾</h4>
                        <div class="filter-options">
                            {% for tag in popular_tags %}
                            <label class="filter-option">
                                <input type="checkbox" name="tags" value="{{ tag.name }}" {{ 'checked' if tag.name in filters.tags else '' }}>
                                <span class="checkmark"></span>
                                {{ tag.name }} ({{ tag.count }})
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </aside>

                <!-- æœç´¢ç»“æœä¸»ä½“ -->
                <div class="results-main">
                    <!-- æ’åºå’Œè§†å›¾æ§åˆ¶ -->
                    <div class="results-controls">
                        <div class="sort-options">
                            <label>æ’åºæ–¹å¼ï¼š</label>
                            <select name="sort" id="sortSelect">
                                <option value="relevance" {{ 'selected' if sort == 'relevance' else '' }}>ç›¸å…³åº¦</option>
                                <option value="rating" {{ 'selected' if sort == 'rating' else '' }}>è¯„åˆ†</option>
                                <option value="popularity" {{ 'selected' if sort == 'popularity' else '' }}>çƒ­åº¦</option>
                                <option value="distance" {{ 'selected' if sort == 'distance' else '' }}>è·ç¦»</option>
                                <option value="price_low" {{ 'selected' if sort == 'price_low' else '' }}>ä»·æ ¼ä»ä½åˆ°é«˜</option>
                                <option value="price_high" {{ 'selected' if sort == 'price_high' else '' }}>ä»·æ ¼ä»é«˜åˆ°ä½</option>
                                <option value="newest" {{ 'selected' if sort == 'newest' else '' }}>æœ€æ–°</option>
                            </select>
                        </div>
                        
                        <div class="view-options">
                            <button class="view-btn {{ 'active' if view_mode == 'list' else '' }}" data-view="list">ğŸ“‹</button>
                            <button class="view-btn {{ 'active' if view_mode == 'grid' else '' }}" data-view="grid">âŠ</button>
                            <button class="view-btn {{ 'active' if view_mode == 'map' else '' }}" data-view="map">ğŸ—ºï¸</button>
                        </div>
                    </div>

                    <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
                    <div class="results-container" id="resultsContainer">
                        {% if results %}
                        <div class="results-list {{ view_mode }}">
                            {% for result in results %}
                            <div class="result-item {{ result.type }}" data-type="{{ result.type }}" data-id="{{ result.id }}">
                                <div class="result-image">
                                    <img src="{{ result.image or '/static/images/default-' + result.type + '.jpg' }}" alt="{{ result.title }}" width="300" height="200">
                                    <div class="result-type-badge">{{ result.type_label }}</div>
                                    {% if result.is_featured %}
                                    <div class="featured-badge">æ¨è</div>
                                    {% endif %}
                                </div>
                                
                                <div class="result-content">
                                    <div class="result-header">
                                        <h3 class="result-title">
                                            <a href="{{ result.url }}">{{ result.title | highlight(query) | safe }}</a>
                                        </h3>
                                        
                                        <div class="result-rating">
                                            {% if result.rating %}
                                            <div class="stars">
                                                {% for i in range(5) %}
                                                <span class="star {{ 'filled' if i < result.rating else '' }}">â­</span>
                                                {% endfor %}
                                            </div>
                                            <span class="rating-text">{{ result.rating }} ({{ result.reviews_count }}æ¡è¯„ä»·)</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="result-info">
                                        <div class="result-location">
                                            ğŸ“ {{ result.location }}
                                        </div>
                                        
                                        {% if result.price %}
                                        <div class="result-price">
                                            {% if result.price == 0 %}
                                            <span class="price-free">å…è´¹</span>
                                            {% else %}
                                            <span class="price-value">Â¥{{ result.price }}</span>
                                            {% if result.original_price and result.original_price > result.price %}
                                            <span class="price-original">Â¥{{ result.original_price }}</span>
                                            {% endif %}
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                        
                                        {% if result.distance %}
                                        <div class="result-distance">
                                            ğŸš— {{ result.distance }}km
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="result-description">
                                        <p>{{ result.description | highlight(query) | safe | truncate(150) }}</p>
                                    </div>
                                    
                                    <div class="result-tags">
                                        {% for tag in result.tags %}
                                        <span class="tag">{{ tag }}</span>
                                        {% endfor %}
                                    </div>
                                    
                                    <div class="result-actions">
                                        <a href="{{ result.url }}" class="btn btn-primary">æŸ¥çœ‹è¯¦æƒ…</a>
                                        <button class="btn btn-outline" onclick="addToFavorites({{ result.id }}, '{{ result.type }}')">â¤ï¸ æ”¶è—</button>
                                        {% if result.type == 'attraction' %}
                                        <button class="btn btn-outline" onclick="planRoute({{ result.id }})">ğŸ—ºï¸ è·¯çº¿</button>
                                        {% endif %}
                                        <button class="btn btn-outline" onclick="shareResult({{ result.id }})">ğŸ“¤ åˆ†äº«</button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- åˆ†é¡µ -->
                        {% if pagination.pages > 1 %}
                        <div class="pagination">
                            {% if pagination.has_prev %}
                            <a href="{{ url_for('main.search', q=query, page=pagination.prev_num, **request.args) }}" class="page-btn prev">ä¸Šä¸€é¡µ</a>
                            {% endif %}
                            
                            {% for page_num in pagination.iter_pages() %}
                            {% if page_num %}
                            {% if page_num != pagination.page %}
                            <a href="{{ url_for('main.search', q=query, page=page_num, **request.args) }}" class="page-btn">{{ page_num }}</a>
                            {% else %}
                            <span class="page-btn active">{{ page_num }}</span>
                            {% endif %}
                            {% else %}
                            <span class="page-btn ellipsis">â€¦</span>
                            {% endif %}
                            {% endfor %}
                            
                            {% if pagination.has_next %}
                            <a href="{{ url_for('main.search', q=query, page=pagination.next_num, **request.args) }}" class="page-btn next">ä¸‹ä¸€é¡µ</a>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% else %}
                        <!-- æ— æœç´¢ç»“æœ -->
                        <div class="no-results">
                            <div class="no-results-icon">ğŸ”</div>
                            <h3>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</h3>
                            <p>æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°ä¸ "{{ query }}" ç›¸å…³çš„å†…å®¹</p>
                            
                            <div class="search-suggestions">
                                <h4>æœç´¢å»ºè®®ï¼š</h4>
                                <ul>
                                    <li>æ£€æŸ¥è¾“å…¥çš„å…³é”®è¯æ˜¯å¦æ­£ç¡®</li>
                                    <li>å°è¯•ä½¿ç”¨æ›´é€šç”¨çš„å…³é”®è¯</li>
                                    <li>å‡å°‘ç­›é€‰æ¡ä»¶</li>
                                    <li>å°è¯•æœç´¢ç›¸å…³çš„åŸå¸‚æˆ–æ™¯ç‚¹åç§°</li>
                                </ul>
                            </div>
                            
                            <div class="popular-searches">
                                <h4>çƒ­é—¨æœç´¢ï¼š</h4>
                                <div class="popular-tags">
                                    {% for popular in popular_searches %}
                                    <a href="{{ url_for('main.search', q=popular) }}" class="popular-tag">{{ popular }}</a>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <div class="no-results-actions">
                                <a href="{{ url_for('main.index') }}" class="btn btn-primary">è¿”å›é¦–é¡µ</a>
                                <button class="btn btn-outline" onclick="clearSearch()">é‡æ–°æœç´¢</button>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- åœ°å›¾è§†å›¾ -->
                    <div class="map-view hidden" id="mapView">
                    <div id="searchMap" class="search-map"></div>
                        <div class="map-controls">
                            <button class="btn btn-outline" id="centerMapBtn">ğŸ“ å±…ä¸­æ˜¾ç¤º</button>
                            <button class="btn btn-outline" id="clusterToggleBtn">ğŸ”— èšåˆæ˜¾ç¤º</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>å…³äºæˆ‘ä»¬</h4>
                    <p>ç‚¹äº®ä¸­å›½è‡´åŠ›äºä¸ºæ¯ä¸ªäººæä¾›ç¾å¥½çš„æ—…è¡Œä½“éªŒ</p>
                </div>
                <div class="footer-section">
                    <h4>è”ç³»æˆ‘ä»¬</h4>
                    <p>é‚®ç®±ï¼šcontact@lightchina.com</p>
                    <p>ç”µè¯ï¼š400-123-4567</p>
                </div>
                <div class="footer-section">
                    <h4>å‹æƒ…é“¾æ¥</h4>
                    <a href="#">æ—…æ¸¸å±€å®˜ç½‘</a>
                    <a href="#">æ— éšœç¢æ—…æ¸¸åä¼š</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Â© 2024 ç‚¹äº®ä¸­å›½. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY"></script>
    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
    <script>
        // é¡µé¢æ•°æ®
        const searchData = {
            query: {{ query | tojson }},
            results: {{ results | tojson }},
            filters: {{ filters | tojson }},
            totalResults: {{ total_results }},
            currentPage: {{ pagination.page if pagination else 1 }}
        };
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
            initSearchResults();
            
            // åˆå§‹åŒ–ç­›é€‰å™¨
            initFilters();
            
            // åˆå§‹åŒ–æ’åº
            initSorting();
            
            // åˆå§‹åŒ–è§†å›¾åˆ‡æ¢
            initViewToggle();
            
            // åˆå§‹åŒ–åœ°å›¾
            if (searchData.results.length > 0) {
                initSearchMap();
            }
            
            // åˆå§‹åŒ–äº¤äº’åŠŸèƒ½
            initInteractions();
        });
    </script>
</body>
</html>